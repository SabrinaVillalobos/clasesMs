# Cliente SOAP BECH
## Introducción

En este módulo se entregan las funcionalidades esenciales para las llamadas a los servicios SOAP por medio de entradas y salidas de tipo JSON. Cabe destacar que esta librería entregada es un **wraper** de un módulo ya existente **strong-soap**.

## Instalación

Para su correcta instalación se hará uso del administrador de paquetes NPM, el cual se tendrá que ejecutar la siguiente linea de código por medio de un terminal:
```
npm install --save soap-client-bech
```

## Funcionalidades

### 1. strongSoap
Esta funcionalidad nos permitira, por medio del envío de cierta información parametrizada, la consulta a los servicios SOAP bajo una estructura sencilla y liviana. En este caso se utiliza de la estructua JSON y el header de version TRX/Broker 9.

#### Parametros
* **Url**<br>
    Este parametro debe contener la dirección donde se encuentra expuesto el servicio web (WSDL).<br>

```javascript
const url = 'http://167.28.65.55:6106/services/ProcessEmailNB/v1.0?WSDL';
```
* **RequestArgs**<br>
    Este parametro contiene la estructura del body de la consulta que quiera realizar. Como se puede ver, tiene que tener la misma una estructura y nombre de los parámetros esperados por el XML.<br>
    
```javascript
const requestArgs = {
    email: {
        fromAddress: "noreply@gmail.com",
        toAddresses: "test@bancoestado.cl",
        ccAddresses: "",
        bccAddresses: "",
        messageSubject: "TEST",
        messageBody: "<![CDATA[<html><body>test</body></html>]]>",
        signature: ""
    }
};
```
* **Header**<br>
    Este parámetro así como el body debe contener la estructura y nombre de los parámetros esperadados por el XML. En especial para esta funcionalidad se utiliza la estructura header con TRX.<br>

```javascript
const header = {
    "ServiceId": "ProcessEmailNB",
    "Type": "Request",
    "InstitutionType": "BECH",
    "ChannelId": "HB",
    "FeatureId": "TEST",
    "BranchId": "",
    "TerminalId": "",
    "TimeStamp": "",
    "Client": {
        "UserAgent": "test",
        "Address": "test",
        "SessionId": "0",
        "UserId": "",
        "OerationId": "0"
    }
}
```
* **FuncionWSDL**<br>
    En este parámetro se require de los 3 nombres de la estructura del WSDL para la llamada a la operación: servicio (1), binding (2), operacion (3).<br>
    
```javascript
var funcionWSDL = ['servicio', 'binding', 'operacion'];
```

#### Llamada a funcionalidad
Para la llamada a la funcionalidad se requerirá de la inclusión del módulo desarrollado, definido se llama la función en conjunto con los 4 parametros previamente definidos. La respuesta a esta función será una promesa, la cual tendremos que controlar y trabajarla como se nos estime conveniente.
```javascript
const strongSoap = require('soap-client-bech');
strongSoap(url, header, requestArgs, funcionWSDL).then(
    (result) => {
        console.log(result);
    }
).catch(
    (err) => {
        console.log(err)
    }
);

```

